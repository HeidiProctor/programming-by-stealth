<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8" />
				
	<!-- Include Bootstrap 4 CSS -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
	
	<!-- Include Font Awesome 5 -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	
	<title>PBS 87b â€” Fibonacci Series Generator</title>
</head>
<body>

<!-- The Page header (a Jumbotron) -->
<header class="container mt-5">
	<div class="jumbotron">
		<h1 class="display-4">PBS 87a <small class="text-muted">Fibonacci Series Generator</small></h1>

		<p class="lead">The final example or optional extra challenge from instalment 87 of the <a href="https://bartb.ie/pbs" target="_blank" rel="noopener">Programming by Stealth series</a>.</p>
	</div>
</header>

<!-- The main page body -->
<main class="container">
	<div class="row justify-content-center">
		<section class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-4">
			<div class="card">
				<h1 class="card-header  h4">Fibonacci Stepper</h1>
				<div class="card-body">
					<form id="fib_fm" action="javascript:void(0);">
						<div class=form-group>
							<button class="btn btn-success form-control" type="submit">Next</button>
						</div>
						<div class=form-group>
							<p class="form-text" id="fib_out"></p>
						</div>
						<div class=form-group>
							<button class="btn btn-danger form-control" type="reset">Reset</button>
						</div>
					</form>
				</div>
			</div>
		</section>
	</div>
</main>

<!-- Sequence Value Template -->
<script type="text/html" id="fib_num_tpl">
	<span class="h4"><span class="badge badge-primary fib_val fib_val_current">{{num}}</span></span>
</script>

<!-- Include Bootstrap JavaScript from CDNs -->
<script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<!-- Include Mustache from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.1.0/mustache.min.js" integrity="sha256-MPgtcamIpCPKRRm1ppJHkvtNBAuE71xcOM+MmQytXi8=" crossorigin="anonymous"></script>

<!-- This Page's Local JavaScript Code -->
<script type="text/javascript">
	//
	// Document ready handler
	//
	$(function(){
		// load the template for rendering a number in the series
		const fibNumTpl = $('#fib_num_tpl').html();
		
		// variable to store the Fibonacci generator object
		let fibGenObj = null;
		
		// variables for storing the needed page elements
		const $fibOut = $('#fib_out');
		
		// add event handlers to the Fibonacci UI
		// and when done, call the reset event
		$('#fib_fm').on('reset', function(){
			// create a new accumulator generator object
			fibGenObj = fibonacci();
			
			// empty the output area
			$fibOut.empty();
			
			// step to the first value
			$(this).trigger('submit');
		}).on('submit', function(){
			// get the next value in the sequence
			const newVal = fibGenObj.next().value;
			
			// generate the markup for the new value
			const newValHTML = Mustache.render(fibNumTpl, { num: newVal });
			
			// un-highlight the previous value
			$('.fib_val.fib_val_current', $fibOut)
				.removeClass('badge-primary fib_val_current')
				.addClass('badge-secondary')
				.unwrap();
			
			// append the new value
			$fibOut.append(newValHTML);
		}).trigger('reset');
	});
	
	//
	// Define functions
	//
	
	// Fibonacci generator function
	function* fibonacci(){
		// variable for the previous state
		// set to zero per the rules
		let prev = 0;
		
		// yield the first value in the series
		yield prev;
		
		// variable for the current state
		// set to 1 per th rules
		let cur = 1;
		
		// yield the second value in the series
		yield cur;
		
		// keep calculating the next value for ever
		while(true){
			// calcualte the next value
			const newVal = cur + prev;
			
			// update the previous value
			prev = cur;
			
			// update and yield the current value
			cur = newVal;
			yield cur;
		}
	}
</script>

</body>
</html>